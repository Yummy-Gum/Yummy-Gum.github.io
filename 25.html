<!DOCTYPE html>
<html>
<head>
	<title></title>
</head>
<h1 id = "1"></h1>
<h1 id = "2"></h1>
<h1 id = "3"></h1>
<h1 id = "4"></h1>
<body>
	<canvas id ='canva' width ="400" height = "400" style = "background-color: rgb(200,198,200);" ></canvas>
	<script type="text/javascript">
		var ddeath = false;
		var x;
		var y;
		var ldeath = false;
		var rdeath = false;
		var udeath = false;
		var up = false;
		var right = false;
		var left = false;
		var down = false;
		var ctx = canva.getContext('2d');
		var actualhi = canva.getBoundingClientRect();
		function dosomething(event) {
			x = event.touches[0].clientX - actualhi.left;
			y = event.touches[0].clientY -actualhi.top;
			if (y > 0 && ((y < x && x > 0 && x < 200) || (y < (400 - x) && x > 200 && x < 400))) {
					up = true

			}
			if (x < 400 && ((x > y && y > 200 && y < 400) || (x > (400 - y) && y > 0 && y < 200))) {
					right = true

			}
			if (x > 0 && ((x < y && y > 0 && y < 200) || (x < (400 - y) && y > 200 && y < 400))) {
					left = true

			}
			if (y < 400 && ((y > x && x < 400 && x > 200) || (y > (400 - x) && x > 0 && x < 200))) {
					down = true

			}
			touchhandling()
		}
		function generate() {
			ldeath = false;
			ddeath = false;
			rdeath = false;
			udeath = false;
			var temporary = true;
			i = 0
			while (i<16) {
				if (grid[i] == 0) {
					temporary = false;
					break;
				}
				i += 1;
			}
			if (temporary == false) {
				while (true) {
					i = Math.floor(Math.random()*16);
					if (grid[i] == 0){
						grid[i] = 2;
						break;
					}
				}
			} else {
				alert("game over")
			}
		}
		function updateGrid() {
			var colour;
		  	i = 0;
		  	while (i<4) {
		  		j = 0;
		  		while (j < 4) {
		  			colour = grid[i*4 + j];
		  			if (colour == 0) {
		  				ctx.fillStyle = "rgb(255,255,255)";
		  			}
		  			if (colour == 2) {
		  				ctx.fillStyle = "rgb(200,200,200)";
		  			}
		  			if (colour == 1) {
		  				ctx.fillStyle = "rgb(140,140,140)";
		  			}
		  			if (colour == 0.5) {
		  				ctx.fillStyle = "rgb(180,140,100)";
		  			}
		  			if (colour == 0.25) {
		  				ctx.fillStyle = "rgb(220,180,50)";
		  			}
		  			if (colour == 0.125) {
		  				ctx.fillStyle = "rgb(255,200,10)";
		  			}
		  			if (colour == 0.0625) {
		  				ctx.fillStyle = "rgb(255,255,10)";
		  			}
		  			if (colour < 0.0625 && colour != 0) {
		  				ctx.fillStyle = "rgb(0,255,0)"
		  			}
		  			ctx.fillRect(j*100,i*100,j*100+100,i*100+100);
		  			if (grid[i*4 +j] != 0) {
			  			ctx.font = "baskerville";
			  			ctx.fillStyle = "black";
						ctx.textAlign = "center";
						ctx.fillText(grid[i*4 +j], j*100+50, i*100+50); 
					}
		  			j+=1;
		  		}
		  		i += 1
		  	}
		}





		
		var i;
		var j;
		var k;
		const grid = 
	   [0,0,0,0,
		0,0,0,0,
		0,0,0,0,
		0,0,0,0,

		0,0,0,0];
		generate()
		generate()
		updateGrid()
		function uniKeyCode(event) {
		  	var key = event.keyCode;
		  	if (key == 40) { //down
		  		ddeath = true;
		  		i = 3
		  		while (i > -1) {
		  			j = 0
		   			while (j < 4) {
						k = 0;
		  				while (k < 3-i) {
		  					if (0==grid[((i+k+1)*4)+j] && 0!=grid[((i+k)*4)+j]) {
		  						k += 1;
			  					grid[((i+k)*4)+j] = grid[((i+k-1)*4)+j];
			  					grid[((i+k-1)*4)+j] = 0;
			  					ddeath = false;
			  					ldeath = false;
								rdeath = false;
								udeath = false;
			  				} else {
			  					break;
			  				}
		  				}
		  				if (grid[((i+k)*4)+j]==grid[((i+k+1)*4)+j] && 0!=grid[((i+k)*4)+j]) {
		  					grid[((i+k+1)*4)+j] = grid[((i+k)*4)+j]/2;
							grid[((i+k)*4)+j] = 0;
							ddeath = false;
							ldeath = false;
							rdeath = false;
							udeath = false;
		  				}
		  				j += 1;
		  			}
		  			i -= 1
		  		}
		  	}
		  	if (key == 39) { //right
		  		rdeath = true;
		  		j = 0;
		  		while (j < 4) {
		  			i = 3;
		   			while (i > -1) {
						k = 0;
		  				while (k < 3-i) {
		  					if (0==grid[((i+k+1))+j*4] && 0!=grid[((i+k))+j*4]) {
		  						k += 1;
			  					grid[((i+k))+j*4] = grid[((i+k-1))+j*4];
			  					grid[((i+k-1))+j*4] = 0;
			  					ldeath = false;
			  					ddeath = false;
								rdeath = false;
								udeath = false;
			  				} else {
			  					break;
			  				}
		  				}
		  				if (grid[((i+k))+j*4]==grid[((i+k+1))+j*4] && i+k != 3 && 0!=grid[((i+k))+j*4]) {
		  					grid[((i+k+1))+j*4] = grid[((i+k))+j*4]/2;
							grid[((i+k))+j*4] = 0;
							ldeath = false;
							ddeath = false;
							rdeath = false;
							udeath = false;
		  				}
		  				i -= 1;
		  			}
		  			j += 1;
		  		}
		  	}
		  	if (key == 38) { //up
		  		udeath = true;
		  		i = 0;
		  		while (i < 4) {
		  			j = 0;
		   			while (j < 4) {
						k = 0;
		  				while (k < i) {
		  					if (0==grid[((i-k-1))*4+j] && 0!=grid[((i-k)*4)+j]) {
		  						k += 1;
			  					grid[((i-k))*4+j] = grid[((i-k+1))*4+j];
			  					grid[((i-k+1))*4+j] = 0;
			  					ddeath = false;
								ldeath = false;
								rdeath = false;
								udeath = false;
			  				} else {
			  					break;
			  				}
		  				}
		  				if (grid[((i-k))*4+j]==grid[((i-k-1))*4+j] && i-k != 0 && 0!=grid[((i-k)*4)+j]) {
		  					grid[((i-k-1))*4+j] = grid[((i-k))*4+j]/2;
							grid[((i-k))*4+j] = 0;
							ddeath = false;
							ldeath = false;
							rdeath = false;
							udeath = false;
		  				}
		  				j += 1;
		  			}
		  			i += 1;
		  		}
		  	}
		  	if (key == 37) { //left
		  		ldeath = true;
		  		j = 3;
		  		while (j > -1) {
		  			i = 0;
		   			while (i < 4) {
						k = 0;
		  				while (k < i) {
		  					if (0==grid[((i-k-1))+j*4] && 0!=grid[((i-k))+j*4]) {
		  						k += 1;
			  					grid[((i-k))+j*4] = grid[((i-k+1))+j*4];
			  					grid[((i-k+1))+j*4] = 0;
			  					ldeath = false;
			  					ddeath = false;
								rdeath = false;
								udeath = false;
			  				} else {
			  					break;
			  				}
		  				}
		  				if (grid[((i-k))+j*4]==grid[((i-k-1))+j*4] && i-k != 0 && 0!=grid[((i-k))+j*4]) {
		  					grid[((i-k-1))+j*4] = grid[((i-k))+j*4]/2;
							grid[((i-k))+j*4] = 0;
							ldeath = false;
							ddeath = false;
							rdeath = false;
							udeath = false;
		  				}
		  				i += 1;
		  			}
		  			j -= 1;
		  		}
		  	}
		  	if (ldeath == false && ddeath == false && udeath == false && rdeath == false) {
		  		generate()
		  		updateGrid()
		  	} 
		  	if (ldeath == true && ddeath == true && udeath == true && rdeath == true) {
		  		generate()
		  	}
		}


		function touchhandling() {
		  	if (down == true) { //down
		  		down = false;
		  		ddeath = true;
		  		i = 3
		  		while (i > -1) {
		  			j = 0
		   			while (j < 4) {
						k = 0;
		  				while (k < 3-i) {
		  					if (0==grid[((i+k+1)*4)+j] && 0!=grid[((i+k)*4)+j]) {
		  						k += 1;
			  					grid[((i+k)*4)+j] = grid[((i+k-1)*4)+j];
			  					grid[((i+k-1)*4)+j] = 0;
			  					ddeath = false;
			  					ldeath = false;
								rdeath = false;
								udeath = false;
			  				} else {
			  					break;
			  				}
		  				}
		  				if (grid[((i+k)*4)+j]==grid[((i+k+1)*4)+j] && 0!=grid[((i+k)*4)+j]) {
		  					grid[((i+k+1)*4)+j] = grid[((i+k)*4)+j]/2;
							grid[((i+k)*4)+j] = 0;
							ddeath = false;
							ldeath = false;
							rdeath = false;
							udeath = false;
		  				}
		  				j += 1;
		  			}
		  			i -= 1
		  		}
		  	}
		  	if (right == true) { //right
		  		rdeath = true;
		  		right = false;
		  		j = 0;
		  		while (j < 4) {
		  			i = 3;
		   			while (i > -1) {
						k = 0;
		  				while (k < 3-i) {
		  					if (0==grid[((i+k+1))+j*4] && 0!=grid[((i+k))+j*4]) {
		  						k += 1;
			  					grid[((i+k))+j*4] = grid[((i+k-1))+j*4];
			  					grid[((i+k-1))+j*4] = 0;
			  					ldeath = false;
			  					ddeath = false;
								rdeath = false;
								udeath = false;
			  				} else {
			  					break;
			  				}
		  				}
		  				if (grid[((i+k))+j*4]==grid[((i+k+1))+j*4] && i+k != 3 && 0!=grid[((i+k))+j*4]) {
		  					grid[((i+k+1))+j*4] = grid[((i+k))+j*4]/2;
							grid[((i+k))+j*4] = 0;
							ldeath = false;
							ddeath = false;
							rdeath = false;
							udeath = false;
		  				}
		  				i -= 1;
		  			}
		  			j += 1;
		  		}
		  	}
		  	if (up == true) { //up
		  		up = false;
		  		udeath = true;
		  		i = 0;
		  		while (i < 4) {
		  			j = 0;
		   			while (j < 4) {
						k = 0;
		  				while (k < i) {
		  					if (0==grid[((i-k-1))*4+j] && 0!=grid[((i-k)*4)+j]) {
		  						k += 1;
			  					grid[((i-k))*4+j] = grid[((i-k+1))*4+j];
			  					grid[((i-k+1))*4+j] = 0;
			  					ddeath = false;
								ldeath = false;
								rdeath = false;
								udeath = false;
			  				} else {
			  					break;
			  				}
		  				}
		  				if (grid[((i-k))*4+j]==grid[((i-k-1))*4+j] && i-k != 0 && 0!=grid[((i-k)*4)+j]) {
		  					grid[((i-k-1))*4+j] = grid[((i-k))*4+j]/2;
							grid[((i-k))*4+j] = 0;
							ddeath = false;
							ldeath = false;
							rdeath = false;
							udeath = false;
		  				}
		  				j += 1;
		  			}
		  			i += 1;
		  		}
		  	}
		  	if (left == true) { //left
		  		ldeath = true;
		  		left = false;
		  		j = 3;
		  		while (j > -1) {
		  			i = 0;
		   			while (i < 4) {
						k = 0;
		  				while (k < i) {
		  					if (0==grid[((i-k-1))+j*4] && 0!=grid[((i-k))+j*4]) {
		  						k += 1;
			  					grid[((i-k))+j*4] = grid[((i-k+1))+j*4];
			  					grid[((i-k+1))+j*4] = 0;
			  					ldeath = false;
			  					ddeath = false;
								rdeath = false;
								udeath = false;
			  				} else {
			  					break;
			  				}
		  				}
		  				if (grid[((i-k))+j*4]==grid[((i-k-1))+j*4] && i-k != 0 && 0!=grid[((i-k))+j*4]) {
		  					grid[((i-k-1))+j*4] = grid[((i-k))+j*4]/2;
							grid[((i-k))+j*4] = 0;
							ldeath = false;
							ddeath = false;
							rdeath = false;
							udeath = false;
		  				}
		  				i += 1;
		  			}
		  			j -= 1;
		  		}
		  	}
		  	alert("hi")
		  	if (right == true || left == true || up == true || down == true) {
			  	if (ldeath == false && ddeath == false && udeath == false && rdeath == false) {
			  		generate()
			  		updateGrid()
			  	} 
			  	if (ldeath == true && ddeath == true && udeath == true && rdeath == true) {
			  		generate()
			  	}
			}
		}
		document.addEventListener("keydown", uniKeyCode);
		document.getElementById("canva").addEventListener("touchstart", dosomething);
	</script>
</body>
</html>